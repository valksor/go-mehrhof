name: Release

on:
    release:
        types: [ published ]

concurrency:
    group: release-${{ github.ref }}
    cancel-in-progress: false

permissions:
    contents: write
    packages: write
    id-token: write

env:
    GO_VERSION: '1.25'

jobs:
    release:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v6
                with:
                    fetch-depth: 0

            -   name: Set up Go
                uses: actions/setup-go@v6
                with:
                    go-version: ${{ env.GO_VERSION }}
                    cache: true

            -   name: Install Cosign
                uses: sigstore/cosign-installer@v3

            -   name: Run GoReleaser
                uses: goreleaser/goreleaser-action@v6
                with:
                    version: latest
                    args: release --clean
                env:
                    GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
                    GORELEASER_CURRENT_TAG: ${{ github.event.release.tag_name }}
